from django.shortcuts import render
from django.views.generic import View
import requests
import os
from datetime import datetime

# Create your views here.
class TextRenderer(View):
    def get(self, request, *args, **kwargs):
        WAKA_KEY = os.environ.get("WAKATIME_API_KEY")

        wakatime_stats = requests.get(
            f"https://wakatime.com/api/v1/users/current/projects?api_key={WAKA_KEY}"
        ).json()
        wakatime_all_time_stats = requests.get(
            f"https://wakatime.com/api/v1/users/current/all_time_since_today?api_key={WAKA_KEY}"
        ).json()

        base64Icon1 = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUiIGhlaWdodD0iMTMiIHZpZXdCb3g9IjAgMCAxNSAxMyIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTAgMFY0LjYxNTM4SDMuMjUwODNMNS4xOTIzMSA4LjAyMzk2VjEyLjExNTRIOS44MDc2OVY3LjVINi4yMjEwOEw0LjU3OTMzIDQuNjE1MzhINC42MTUzOFYyLjg4NDYxSDEwLjM4NDZWNC42MTUzOEgxNVYwSDEwLjM4NDZWMS43MzA3N0g0LjYxNTM4VjBIMFpNMS4xNTM4NSAxLjE1Mzg1SDMuNDYxNTRWMy40NjE1NEgxLjE1Mzg1VjEuMTUzODVaTTExLjUzODUgMS4xNTM4NUgxMy44NDYyVjMuNDYxNTRIMTEuNTM4NVYxLjE1Mzg1Wk02LjU4NzI5IDguNjUzODRIOC42NTM4NVYxMC45NjE1SDYuMzQ2MTVWOC43OTEzMkw2LjU4NzI5IDguNjUzODRaIiBmaWxsPSJ1cmwoI3BhaW50MF9saW5lYXJfMV81OCkiLz4KPGRlZnM+CjxsaW5lYXJHcmFkaWVudCBpZD0icGFpbnQwX2xpbmVhcl8xXzU4IiB4MT0iNy41IiB5MT0iMC4xNjExMzUiIHgyPSI3LjUiIHkyPSIxMi4wOTIyIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CjxzdG9wIHN0b3AtY29sb3I9IiNFQjU5NUIiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjRTQxQjM5Ii8+CjwvbGluZWFyR3JhZGllbnQ+CjwvZGVmcz4KPC9zdmc+Cg=="

        base64Icon2 = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUiIGhlaWdodD0iMTUiIHZpZXdCb3g9IjAgMCAxNSAxNSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTAgMFYxLjg3NUgxNVYwSDBaTTcuNSAzLjc1TDEuODc1IDkuMzc1SDUuNjI1VjE1SDkuMzc1VjkuMzc1SDEzLjEyNUw3LjUgMy43NVoiIGZpbGw9InVybCgjcGFpbnQwX2xpbmVhcl8xXzE0OCkiLz4KPGRlZnM+CjxsaW5lYXJHcmFkaWVudCBpZD0icGFpbnQwX2xpbmVhcl8xXzE0OCIgeDE9IjcuNSIgeTE9IjAuMTk5NSIgeDI9IjcuNSIgeTI9IjE0Ljk3MTMiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agc3RvcC1jb2xvcj0iI0VCNTk1QiIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNFNDFCMzkiLz4KPC9saW5lYXJHcmFkaWVudD4KPC9kZWZzPgo8L3N2Zz4K"

        base64Icon3 = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkiIGhlaWdodD0iMTUiIHZpZXdCb3g9IjAgMCAxOSAxNSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTUuMDc2MDMgNS4xOTEyMUwyLjMwNTc5IDcuNDk5NzVMNS4wNzYwMyA5LjgwODI4QzUuMjU5NCA5Ljk2MTA4IDUuMzc0NTYgMTAuMTgwNSA1LjM5NjE3IDEwLjQxODJDNS40MTc3OCAxMC42NTU5IDUuMzQ0MDggMTAuODkyNCA1LjE5MTI4IDExLjA3NThDNS4wMzg0NyAxMS4yNTkyIDQuODE5MDkgMTEuMzc0MyA0LjU4MTM4IDExLjM5NkM0LjM0MzY3IDExLjQxNzYgNC4xMDcxMSAxMS4zNDM5IDMuOTIzNzQgMTEuMTkxMUwwLjMyMzgzMiA4LjE5MTEzQzAuMjIyNDc3IDguMTA2NjcgMC4xNDA5MyA4LjAwMDk2IDAuMDg0OTY5MSA3Ljg4MTQ4QzAuMDI5MDA3OCA3Ljc2MiAwIDcuNjMxNjggMCA3LjQ5OTc1QzAgNy4zNjc4MSAwLjAyOTAwNzggNy4yMzc0OSAwLjA4NDk2OTEgNy4xMTgwMUMwLjE0MDkzIDYuOTk4NTMgMC4yMjI0NzcgNi44OTI4MiAwLjMyMzgzMiA2LjgwODM2TDMuOTIzNzQgMy44MDg0NEM0LjAxNDU0IDMuNzMyNzggNC4xMTkzNCAzLjY3NTc0IDQuMjMyMTggMy42NDA1OEM0LjM0NTAyIDMuNjA1NDMgNC40NjM2OCAzLjU5Mjg0IDQuNTgxMzggMy42MDM1NEM0LjY5OTA4IDMuNjE0MjQgNC44MTM1MiAzLjY0ODAyIDQuOTE4MTcgMy43MDI5NUM1LjAyMjgxIDMuNzU3ODggNS4xMTU2MSAzLjgzMjg4IDUuMTkxMjggMy45MjM2OEM1LjI2Njk0IDQuMDE0NDcgNS4zMjM5NyA0LjExOTI4IDUuMzU5MTMgNC4yMzIxMkM1LjM5NDI4IDQuMzQ0OTYgNS40MDY4NyA0LjQ2MzYxIDUuMzk2MTcgNC41ODEzMUM1LjM4NTQ3IDQuNjk5MDEgNS4zNTE2OSA0LjgxMzQ2IDUuMjk2NzYgNC45MTgxQzUuMjQxODMgNS4wMjI3NSA1LjE2NjgzIDUuMTE1NTUgNS4wNzYwMyA1LjE5MTIxWk0xOC4yNzU3IDYuODA4MzZMMTQuNjc1OCAzLjgwODQ0QzE0LjU4NSAzLjczMjc4IDE0LjQ4MDIgMy42NzU3NCAxNC4zNjc0IDMuNjQwNThDMTQuMjU0NSAzLjYwNTQzIDE0LjEzNTkgMy41OTI4NCAxNC4wMTgyIDMuNjAzNTRDMTMuOTAwNSAzLjYxNDI0IDEzLjc4NiAzLjY0ODAyIDEzLjY4MTQgMy43MDI5NUMxMy41NzY3IDMuNzU3ODggMTMuNDgzOSAzLjgzMjg4IDEzLjQwODMgMy45MjM2OEMxMy4zMzI2IDQuMDE0NDcgMTMuMjc1NiA0LjExOTI4IDEzLjI0MDQgNC4yMzIxMkMxMy4yMDUyIDQuMzQ0OTYgMTMuMTkyNyA0LjQ2MzYxIDEzLjIwMzQgNC41ODEzMUMxMy4yMTQxIDQuNjk5MDEgMTMuMjQ3OCA0LjgxMzQ2IDEzLjMwMjggNC45MTgxQzEzLjM1NzcgNS4wMjI3NSAxMy40MzI3IDUuMTE1NTUgMTMuNTIzNSA1LjE5MTIxTDE2LjI5MzcgNy40OTk3NUwxMy41MjM1IDkuODA4MjhDMTMuNDMyNyA5Ljg4Mzk0IDEzLjM1NzcgOS45NzY3NCAxMy4zMDI4IDEwLjA4MTRDMTMuMjQ3OCAxMC4xODYgMTMuMjE0MSAxMC4zMDA1IDEzLjIwMzQgMTAuNDE4MkMxMy4xODE4IDEwLjY1NTkgMTMuMjU1NSAxMC44OTI0IDEzLjQwODMgMTEuMDc1OEMxMy41NjExIDExLjI1OTIgMTMuNzgwNCAxMS4zNzQzIDE0LjAxODIgMTEuMzk2QzE0LjEzNTkgMTEuNDA2NyAxNC4yNTQ1IDExLjM5NDEgMTQuMzY3NCAxMS4zNTg5QzE0LjQ4MDIgMTEuMzIzOCAxNC41ODUgMTEuMjY2NyAxNC42NzU4IDExLjE5MTFMMTguMjc1NyA4LjE5MTEzQzE4LjM3NzEgOC4xMDY2NyAxOC40NTg2IDguMDAwOTYgMTguNTE0NiA3Ljg4MTQ4QzE4LjU3MDUgNy43NjIgMTguNTk5NSA3LjYzMTY4IDE4LjU5OTUgNy40OTk3NUMxOC41OTk1IDcuMzY3ODEgMTguNTcwNSA3LjIzNzQ5IDE4LjUxNDYgNy4xMTgwMUMxOC40NTg2IDYuOTk4NTMgMTguMzc3MSA2Ljg5MjgyIDE4LjI3NTcgNi44MDgzNlpNMTIuMDA3MyAwLjA1NDEzODZDMTEuNzgzIC0wLjAyNzM4NjggMTEuNTM1NCAtMC4wMTY0ODM0IDExLjMxOTIgMC4wODQ0NTEzQzExLjEwMjkgMC4xODUzODYgMTAuOTM1NSAwLjM2ODA4OCAxMC44NTM5IDAuNTkyMzgxTDYuMDU0MDUgMTMuNzkyQzYuMDEzNTggMTMuOTAzMSA1Ljk5NTQxIDE0LjAyMTEgNi4wMDA1NSAxNC4xMzkyQzYuMDA1NyAxNC4yNTczIDYuMDM0MDYgMTQuMzczMyA2LjA4NDAzIDE0LjQ4MDRDNi4xMzQgMTQuNTg3NiA2LjIwNDU5IDE0LjY4MzggNi4yOTE3NyAxNC43NjM3QzYuMzc4OTUgMTQuODQzNSA2LjQ4MTAxIDE0LjkwNTQgNi41OTIxMiAxNC45NDU4QzYuNzAzMjMgMTQuOTg2MiA2LjgyMTIxIDE1LjAwNDMgNi45MzkzMiAxNC45OTkxQzcuMDU3NDMgMTQuOTkzOSA3LjE3MzM2IDE0Ljk2NTUgNy4yODA0OCAxNC45MTU1QzcuMzg3NiAxNC44NjU0IDcuNDgzODEgMTQuNzk0OCA3LjU2MzYyIDE0LjcwNzZDNy42NDM0MyAxNC42MjAzIDcuNzA1MjcgMTQuNTE4MiA3Ljc0NTYxIDE0LjQwNzFMMTIuNTQ1NSAxLjIwNzQ1QzEyLjU4NTkgMS4wOTYzOSAxMi42MDQgMC45Nzg0NTIgMTIuNTk4OCAwLjg2MDM4MkMxMi41OTM2IDAuNzQyMzEzIDEyLjU2NTIgMC42MjY0MjEgMTIuNTE1MyAwLjUxOTMyNUMxMi40NjUzIDAuNDEyMjI5IDEyLjM5NDcgMC4zMTYwMjYgMTIuMzA3NSAwLjIzNjIwOUMxMi4yMjA0IDAuMTU2MzkyIDEyLjExODMgMC4wOTQ1MjQzIDEyLjAwNzMgMC4wNTQxMzg2WiIgZmlsbD0idXJsKCNwYWludDBfbGluZWFyXzFfMTY3KSIvPgo8ZGVmcz4KPGxpbmVhckdyYWRpZW50IGlkPSJwYWludDBfbGluZWFyXzFfMTY3IiB4MT0iOS4yOTk3NyIgeTE9IjAuMTk5NSIgeDI9IjkuMjk5NzciIHkyPSIxNC45NzEzIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CjxzdG9wIHN0b3AtY29sb3I9IiNFQjU5NUIiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjRTQxQjM5Ii8+CjwvbGluZWFyR3JhZGllbnQ+CjwvZGVmcz4KPC9zdmc+Cg=="

        context = {
            "proj_name": wakatime_stats["data"][0]["name"],
            "last_commit": wakatime_stats["data"][0][
                "human_readable_last_heartbeat_at"
            ],
            "all_time_coding": wakatime_all_time_stats["data"]["text"],
            "icon_1": base64Icon1,
            "icon_2": base64Icon2,
            "icon_3": base64Icon3,
        }

        return render(request, "home.html", context, content_type="image/svg+xml")
